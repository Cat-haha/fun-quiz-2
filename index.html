<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script>
      // Initialize Firebase (must be before any usage)
      const firebaseConfig = {
        apiKey: "AIzaSyCDlykaXg7KdQPv3jeCOrnRV1Z_6P1n5S0",
        authDomain: "funquiz-f5177.firebaseapp.com",
        projectId: "funquiz-f5177",
        storageBucket: "funquiz-f5177.appspot.com",
        messagingSenderId: "243832133348",
        appId: "1:243832133348:web:03d6746d63388112417ef1",
        measurementId: "G-RG453ZV61K"
      };
      if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      }
    </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fun Quiz || Home Page</title>
    <link rel="icon" type="image/png" href="assets/images/all/warmup/Adobe-Express-file.avif" />
    <link rel="stylesheet" href="style.css" />
    <meta name="google-adsense-account" content="ca-pub-1575608125795498" />
    <style type="text/css">
      * {
        cursor: url(https://cur.cursors-4u.net/cursors/cur-2/cur116.cur), auto !important;
      }
      body {
        background: linear-gradient(135deg, #06FD00, #8FCD00, #E59237)
      }
    </style>
    <a
      href="https://www.cursors-4u.com/cursor/2008/12/17/cool-blue-outer-glow-pointer.html"
      target="_blank"
      title="Cool Blue Outer Glow Pointer"
      ><img
        src="https://cur.cursors-4u.net/cursor.png"
        style="display: none"
        border="0"
        alt="Cool Blue Outer Glow Pointer"
        style="position: absolute; top: 0px; right: 0px"
    /></a>
  </head>
  <body>
    <button id="logout-button" style="display: none">Logout</button>
    <button id="google-signin-btn" onclick="signInWithGoogle()">Sign in with Google</button>
    <p id="user-info"></p>
    <div class="body-container">
      <div id="quiz-container" style="display: none">
        <marquee class="marqueeH1" direction="right">
          <h1>FUN QUIZ WARMUP SECTION !!!</h1>
        </marquee>
        <p>
          Based off of MY GOAT ETHAN'S
          <a
            href="https://docs.google.com/presentation/d/1GQsgHi6w7xKAHZJtvmCtOwM8i7Q6u8Nnatovm_fjo9o/edit?usp=sharing"
            target="_blank"
          >
            FUN QUIZ!! </a
          ><br />
          Please be exact with your answers. ALso, this is based off of Ethan's quiz, not my information.
        </p>
        <!-- Quiz UI starts here -->
        <div class="quiz-ui">
          <div id="question-area">
            <div id="question">Loading...</div>
            <img id="question-image" src="" />
            <input
              type="text"
              id="answer"
              placeholder="Type your answer..."
              autocomplete="off"
            />
            <span id="suggestion-box"></span>
            <ul id="suggestions"></ul>
            <button onclick="submitAnswer()">Submit</button>
            <button id="next-button" onclick="goToNextQuestion()">
              Next Question
            </button>
            <button onclick="goBackAnIndex()">Go Back</button>
            <button onclick="goForwardAnIndex()">Go Forward</button>
          </div>
          <div class="feedback-area">
            <div id="feedback"></div>
            <img id="feedback-image" src="" />
            <div id="correct-answer" style="display: none"></div>
          </div>
        </div>
      </div>
      <div class="leaderboard-container">
        <div class="leaderboard-content">
          <h2>Leaderboard</h2>
          <table id="leaderboard-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Score</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
    <!-- Move scripts here to ensure Firebase is initialized and DOM is ready -->
    <script src="custom.js"></script>
    <script src="script.js"></script>
    <script>
      // Google Auth UI logic
      document.addEventListener("DOMContentLoaded", function () {
        firebase.auth().onAuthStateChanged(function(user) {
          const quizContainer = document.getElementById("quiz-container");
          const leaderboard = document.querySelector("leaderboard-container");
          const userInfo = document.getElementById("user-info");
          const signInBtn = document.getElementById("google-signin-btn");
          const logoutBtn = document.getElementById("logout-button");
          if (user) {
            // Save user info to localStorage for consistency
            localStorage.setItem("playerName", user.displayName);
            localStorage.setItem("playerEmail", user.email);
            userInfo.textContent = `Logged in as: ${user.displayName} || Email: ${user.email} Score: ${localStorage.getItem("currentScore") || 0}`;
            quizContainer.style.display = "block";
            leaderboard.style.display = "block";
            signInBtn.style.display = "none";
            logoutBtn.style.display = "inline-block";
          } else {
            quizContainer.style.display = "none";
            leaderboard.style.display = "none";
            signInBtn.style.display = "inline-block";
            logoutBtn.style.display = "none";
          }
        });
        // Attach logout handler robustly
        function attachLogoutHandler() {
          var btn = document.getElementById("logout-button");
          if (btn && !btn._logoutHandlerAttached) {
            btn.onclick = function () {
              firebase.auth().signOut();
            };
            btn._logoutHandlerAttached = true;
          }
        }
        attachLogoutHandler();
        new MutationObserver(attachLogoutHandler).observe(document.body, {childList: true, subtree: true});
      });
      function signInWithGoogle() {
        var provider = new firebase.auth.GoogleAuthProvider();
        provider.setCustomParameters({ prompt: 'select_account' }); // Always prompt account selection
        firebase.auth().signInWithPopup(provider);
      }
    </script>
    <script>
      var questions = [
        {
          question: "#1. What's this?",
          answer: "lettuce",
          image: "/assets/images/all/warmup/image-2025-05-07-210118794.avif",
          feedbackImage:
            "assets/images/all/warmup/image-2025-05-07-210211060.avif",
        },
        {
          question: "#2. What's this?",
          answer: "lettuce",
          image: "assets/images/all/warmup/image-2025-05-07-211843827.avif",
          feedbackImage:
            "assets/images/all/warmup/image-2025-05-07-211940039.avif",
        },
        {
          question: "#3. What's this?",
          answer: "cheese",
          image: "assets/images/all/warmup/image-2025-05-07-212050885.avif",
          feedbackImage:
            "assets/images/all/warmup/image-2025-05-07-212115211.avif",
        },
        {
          question: "#4. What's this?",
          answer: [
            "the concept of the color blue",
            "blue",
            "concept of the color blue",
            "concept of blue",
            "the concept of blue",
          ],
          image: "assets/images/all/warmup/image-2025-05-07-212228619.avif",
          feedbackImage:
            "assets/images/all/warmup/image-2025-05-07-212254297.avif",
        },
        {
          question:
            "#5. This landmass is the largest pile of garbage in the world and is located in the Atlantic Ocean",
          answer: ["great britain", "uk", "the uk", "united kingdom"],
          feedbackImage:
            "assets/images/all/warmup/image-2025-05-07-213857100.avif",
        },
        {
          question: "#6. What's this?",
          answer: "cheese",
          image: "assets/images/all/warmup/image-2025-05-07-214411496.avif",
          feedbackImage:
            "assets/images/all/warmup/image-2025-05-07-214448845.avif",
        },
        {
          question: "#7. What's this?",
          answer: "spinach",
          image: "assets/images/all/warmup/image-2025-05-07-214604298.avif",
          feedbackImage:
            "assets/images/all/warmup/image-2025-05-07-214709003.avif",
        },
        {
          question: "#8. What's this?",
          answer: "red lettuce",
          image: "assets/images/all/warmup/image-2025-05-07-214753670.avif",
          feedbackImage:
            "assets/images/all/warmup/image-2025-05-07-214848136.avif",
        },
        {
          question:
            "#9. This landmass is the largest pile of garbage in the world and is located in the Pacific Ocean",
          answer: ["great pacific garbage patch", "gpgp", "australia"],
          feedbackImage:
            "assets/images/all/warmup/image-2025-05-07-213857100.avif",
        },
        {
          question: "#10. What's this?",
          answer: ["castle", "a castle", "the castle"],
          image: "assets/images/all/warmup/image-2025-05-07-222522503.avif",
          feedbackImage:
            "assets/images/all/warmup/image-2025-05-07-222555230.avif",
        },
        {
          question: "#11. What's this?",
          answer: "digiorno",
          image: "assets/images/all/warmup/unnamed.avif",
          feedbackImage: "assets/images/all/warmup/unnamed-1.avif",
          hintImage: "assets/images/all/warmup/image.avif",
        },
        {
          question: "#12. Where's Waldo? (Click the image)",
          image: "assets/images/all/warmup/unnamed.avif",
          answer: "click",
          feedbackImage:
            "assets/images/all/warmup/Screenshot-2025-05-08-9-04-23-AM.avif",
          type: "click",
          correctAnswer: "click on Waldo's location",
          waldoX: 40,
          waldoY: 220,
        },
        {
          question: "#13. What's this?",
          answer: "lettuce",
          image: "assets/images/all/warmup/unnamed-1.avif",
          feedbackImage: "assets/images/all/warmup/unnamed.avif",
        },
        {
          question: "#14. What's this?",
          answer: [
            "lettuce now with vertical rotation",
            "vertical rotation lettuce",
            "vertical lettuce",
            "vertically rotating lettuce",
            "lettuce",
            "rotating lettuce",
          ],
          image: "assets/images/all/warmup/unnamed.avif",
          feedbackImage:
            "assets/images/all/warmup/Vertically-Rotating-Lettuce.avif",
        },
        {
          question: "#15. What's this?",
          answer: ["cat", "a cat", "the cat"],
          image: "assets/images/all/warmup/unnamed-2.avif",
          feedbackImage: "assets/images/all/warmup/unnamed-1.avif",
        },
        {
          question: "#16. What's this?",
          answer: ["mountain", "a mountain", "the mountain"],
          image: "assets/images/all/warmup/unnamed-3.avif",
          feedbackImage: "assets/images/all/warmup/unnamed-4.avif",
        },
        {
          question: "#17. What was the original, non-diffused image?",
          answer: ["deep fryer", "a deep fryer", "the deep fryer"],
          image: "assets/images/all/warmup/unnamed-4.avif",
          feedbackImage: "assets/images/all/warmup/unnamed-5.avif",
        },
        {
          question: "#18. What's this?",
          answer: "lettuce",
          image: "assets/images/all/warmup/unnamed-7.avif",
          feedbackImage: "assets/images/all/warmup/unnamed-8.avif",
        },
        {
          question: "#19. What are these?",
          answer: ["limes", "green lemons"],
          image: "assets/images/all/warmup/unnamed-9.avif",
          feedbackImage: "assets/images/all/warmup/unnamed.avif",
        },
      ];

            function submitAnswer() {
        const answerInput = document.getElementById("answer");
        const userAnswer = answerInput.value.trim();
        const question = questions[currentQuestionIndex];
        const feedback = document.getElementById("feedback");
        const feedbackImage = document.getElementById("feedback-image");
        const nextButton = document.getElementById("next-button");
        const correctAnswerDiv = document.getElementById("correct-answer");

        feedback.innerHTML = "";
        feedbackImage.style.display = "none";
        correctAnswerDiv.style.display = "none";

        if (question.type === "click") return;

        // === Lettuce easter egg for Digiorno (#11) only ===
        if (
          currentQuestionIndex === 10 &&
          userAnswer.trim().toLowerCase() === "lettuce"
        ) {
          feedback.textContent = "HINT: It's not lettuce";
          if (question.hintImage) {
            feedbackImage.src = question.hintImage;
            feedbackImage.style.display = "block";
          }
          return;
        }

        // === Digiorno special feedback for #11 ===
        if (currentQuestionIndex === 10) {
          const digiornoAnswers = [
            "digiorno",
            "it's digiorno",
            "its digiorno",
            "di giorno",
            "di-giorno",
          ];
          const userAns = userAnswer.trim().toLowerCase();
          if (digiornoAnswers.includes(userAns)) {
            feedback.textContent = `‚úÖ Correct! It's Digiorno!`;
            suggestionBox.style.display = "none";
            let answeredQuestions = JSON.parse(
              localStorage.getItem("answeredQuestions") || "[]"
            );
            if (!answeredQuestions.includes(currentQuestionIndex)) {
              currentScore++;
              updateUserInfo();
              localStorage.setItem("currentScore", currentScore);
              answeredQuestions.push(currentQuestionIndex);
              localStorage.setItem(
                "answeredQuestions",
                JSON.stringify(answeredQuestions)
              );
              question.answeredCorrectly = true;
            }
            // Always show correct answer(s)
            correctAnswerDiv.textContent = `Correct answer(s): digiorno`;
            correctAnswerDiv.style.display = "block";
            if (question.feedbackImage) {
              feedbackImage.src = question.feedbackImage;
              feedbackImage.style.display = "block";
            }
            nextButton.style.display = "inline-block";
            hasSuggested = false;
            // Reset attemptCount for next question
            attemptCount = 0;
            return;
          } else {
            // Track attempts for this question only
            if (typeof window.digiornoAttemptCount === "undefined") {
              window.digiornoAttemptCount = 1;
            } else {
              window.digiornoAttemptCount++;
            }
            if (window.digiornoAttemptCount >= 2) {
              feedback.textContent = `It's not ${userAnswer}, it's Digiorno!`;
              suggestionBox.style.display = "none";
              correctAnswerDiv.textContent = `Correct answer(s): digiorno`;
              correctAnswerDiv.style.display = "block";
              nextButton.style.display = "inline-block";
              if (question.feedbackImage) {
                feedbackImage.src = question.feedbackImage;
                feedbackImage.style.display = "block";
              }
              // Reset for next time this question is loaded
              window.digiornoAttemptCount = 0;
              // Reset attemptCount for next question
              attemptCount = 0;
            } else {
              feedback.textContent = "‚ùå Incorrect. Try again!";
            }
            return;
          }
        }

        // === Standard answer checking for all other questions ===
        const acceptedAnswers = Array.isArray(question.answer)
          ? question.answer.map((a) => a.trim().toLowerCase())
          : [question.answer.trim().toLowerCase()];

        const isCorrect = acceptedAnswers.includes(userAnswer.toLowerCase());

        // === Log answer only once ===
        if (!question.loggedAnswer) {
          userAnswers.push({
            questionIndex: currentQuestionIndex,
            questionText: question.question,
            userAnswer: userAnswer,
            acceptedAnswers,
            isCorrect,
            questionType: "text",
          });
          question.loggedAnswer = true;

          // üíæ Save to localStorage
          localStorage.setItem("userAnswers", JSON.stringify(userAnswers));
        }

        // === Show feedback ===
        if (isCorrect) {
          feedback.textContent = "‚úÖ Correct!";
          suggestionBox.style.display = "none";

          // Prevent infinite score abuse
          let answeredQuestions = JSON.parse(
            localStorage.getItem("answeredQuestions") || "[]"
          );
          if (!answeredQuestions.includes(currentQuestionIndex)) {
            currentScore++;
            updateUserInfo();
            localStorage.setItem("currentScore", currentScore);
            answeredQuestions.push(currentQuestionIndex);
            localStorage.setItem(
              "answeredQuestions",
              JSON.stringify(answeredQuestions)
            );
            question.answeredCorrectly = true;
          }

          // Always show correct answer(s)
          correctAnswerDiv.textContent = `Correct answer(s): ${acceptedAnswers.join(", ")}`;
          correctAnswerDiv.style.display = "block";
          if (question.feedbackImage) {
            feedbackImage.src = question.feedbackImage;
            feedbackImage.style.display = "block";
          }
          nextButton.style.display = "inline-block";
          hasSuggested = false;
          // Reset attemptCount for next question
          attemptCount = 0;
        } else {
          attemptCount = typeof attemptCount === "undefined" ? 1 : attemptCount + 1;
          if (attemptCount >= 2) {
            feedback.textContent = "‚ùå Incorrect.";
            suggestionBox.style.display = "none";

            correctAnswerDiv.textContent = `Correct answer(s): ${acceptedAnswers.join(", ")}`;
            correctAnswerDiv.style.display = "block";
            nextButton.style.display = "inline-block";
            if (question.feedbackImage) {
              feedbackImage.src = question.feedbackImage;
              feedbackImage.style.display = "block";
            }
            // Reset attemptCount for next question
            attemptCount = 0;
          } else {
            feedback.textContent = "‚ùå Incorrect. Try again!";
          }
        }
      }

      // Ensure userAnswers, currentScore, currentQuestionIndex, attemptCount, hasSuggested are defined globally
      if (typeof userAnswers === 'undefined') window.userAnswers = [];
      if (typeof currentScore === 'undefined') window.currentScore = parseInt(localStorage.getItem('currentScore') || '0');
      if (typeof currentQuestionIndex === 'undefined') window.currentQuestionIndex = parseInt(localStorage.getItem('currentQuestionIndex') || '0');
      if (typeof attemptCount === 'undefined') window.attemptCount = 0;
      if (typeof hasSuggested === 'undefined') window.hasSuggested = false;

      // Add Enter key support for answer input and next question
      const answerInput = document.getElementById("answer");
      const nextButton = document.getElementById("next-button");
      if (answerInput) {
        answerInput.addEventListener("keydown", function (e) {
          if (e.key === "Enter") {
            // Only submit answer if feedback is NOT showing (i.e., Next button is hidden)
            if (nextButton && nextButton.style.display === "block") {
              goToNextQuestion();
            }
          }
        });
      }
    </script>
    <script>
      function goBackAnIndex() {
        if (currentQuestionIndex > 0) {
          currentQuestionIndex--;
          localStorage.setItem("currentQuestionIndex", currentQuestionIndex);
          loadQuestion();
        } else {
          alert("You are already at the first question.");
        }
      }
      function goForwardAnIndex() {
        if (currentQuestionIndex < questions.length - 1) {
          currentQuestionIndex++;
          localStorage.setItem("currentQuestionIndex", currentQuestionIndex);
          loadQuestion();
        } else {
          alert("You are already at the last question.");
        }
      }
    </script>
  </body>
</html>
